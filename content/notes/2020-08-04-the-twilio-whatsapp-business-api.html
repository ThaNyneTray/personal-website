---
title: The Twilio API for WhatsApp
author: Desmond Tuiyot
date: '2020-08-04'
slug: twilio-whatsapp-api
categories: []
tags:
  - api
  - whatsapp
  - twilio
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="twilio-api-for-whatsapp-python-quickstart" class="section level1">
<h1>Twilio API for WhatsApp Python Quickstart</h1>
<ul>
<li>We want to send and receive messages with WhatsApp using the <em>Twilio API for WhatsApp</em></li>
<li>We’ll be using
<ul>
<li>Twilio Sandbox for WhatsApp</li>
<li>Python</li>
<li>The Twilio Python Twilio Helper Library</li>
<li>Flask</li>
</ul></li>
</ul>
<ol style="list-style-type: decimal">
<li><strong>Sign Up for Twilio and Activate the Sandbox</strong></li>
</ol>
<ul>
<li>First, sign up for a twilio account <a href="https://www.twilio.com/try-twilio">here</a></li>
<li>Next, sign into your account and activate the <a href="https://www.twilio.com/console/sms/whatsapp/learn">Twilio Sandbox for WhatsApp</a>
<ul>
<li>In order to send messages in production, you have to wait for WhatsApp to approve your account. The sandbox allows you to start developing and using a shared phone number, without having to wait for a dedicated one.</li>
<li>My shared number - <strong>+1(415)523-8886</strong></li>
<li>To send one-way outbound messages, we use certain pre-approved templates from WhatsApp
<ul>
<li>Appointment Reminders</li>
<li>Order Notifications</li>
<li>Verification Codes</li>
</ul></li>
<li>When a user replies to that message, a 24 hour, two-way conversation window is created where you can freely converse with the customer without using templates. Do I want this?</li>
</ul></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><strong>Gather your Twilio credentials</strong></li>
</ol>
<ul>
<li>Here I need <strong>Account SID</strong> and <strong>Auth Token</strong> to authenticate REST API requests. I can find this on my Twilio Console.
<ul>
<li>Account SID - ACb3cc59265b6eefe39b3d14a0123b40e7</li>
<li>Auth Token - ###</li>
</ul></li>
<li></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><strong>Send a Message with WhatsApp in Python</strong></li>
</ol>
<ul>
<li><p>First, you have to opt in to your sandbox by sending a message to your Sandbox number - <code>join &lt;your sandbox name&gt;</code></p></li>
<li><p>Once you join, you can only receive messages from that sandbox</p></li>
<li><p>You can invite others to your sandbox by sending them a url in this form - <code>whatsapp://send?phone=&lt;Your Sandbox Number&gt;&amp;text=&lt;your URL-encoded sandbox keyword&gt;</code> or ask them to send a message to the same message <code>join &lt;your sandbox keyword&gt;</code> to the sandbox number</p></li>
<li><p>Use the following code template to send a message - this is pulled from the Twilio WhatsApp API quickstart page.</p>
<pre class="python"><code># Download the helper library from https://www.twilio.com/docs/python/install
from twilio.rest import Client


# Your Account Sid and Auth Token from twilio.com/console
# DANGER! This is insecure. See http://twil.io/secure
account_sid = &#39;ACb3cc59265b6eefe39b3d14a0123b40e7&#39;
auth_token = &#39;your_auth_token&#39;
client = Client(account_sid, auth_token)

message = client.messages.create(
                              body=&#39;Hello there!&#39;,
                              from_=&#39;whatsapp:+14155238886&#39;,
                              to=&#39;whatsapp:+15005550006&#39;
                          )

print(message.sid)</code></pre></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Receiving WhatsApp Messages</li>
</ol>
<ul>
<li>When you receive a whatsapp message, you will receive a webhook request from Twilio</li>
<li>You can configure webhooks by connecting your Sandbox to an app that’s built to handle incoming message requests - or just build one</li>
<li>To handle the request, I’d need to set up a web application and expose it to the internet</li>
</ul>
</div>
<div id="key-concepts-and-terms-for-the-whatsapp-business-api-with-twilio" class="section level1">
<h1>Key Concepts and Terms for the WhatsApp Business API with Twilio</h1>
<p>WhatsApp is a highly regulated channel, and using it requires documentation and approval from Facebook.
Some key concepts:</p>
<p><strong>The “24-hour window” or “24-hour session”</strong>
* Essentially, an inbound message to your Business number from an end-user kicks off a 24 hour window where you can communicate with the end user and send <em>free-form messages</em>
* If outside of that window, you can only send <em>template messages</em>
<strong>WhatsApp Notification Templates</strong>
* As mentioned before, you can only send pre-approved template messages outside of the 24 hour window of communication.
* When you first get started out, you can submit templates for approval by WhatsApp
* Besides that, Twilio has some templates available (3 of them) that you can use in the Sandbox before your Twilio number and your templates get approved.
<strong>WhatsApp Business Account (WABA)</strong>
* This is an account for sending and receiving messages to and from your end users/clients.
* If connecting using Twilio (which I will?), Twilio is responsible for creating and maintaining a WABA on my behalf
<strong>Facebook Business Manager (FB BM)</strong>
* You need a Facebook Business Manager account in order to get a WABA - FB BM is a tool that you can use to manage and organize your business within the Facebook ecosystem
* Facebook uses your FB BM to verify the business.
* Twilio needs our FB BM id in order to create a WABA for us</p>
</div>
<div id="appendices" class="section level1">
<h1>Appendices</h1>
<div id="appendix-1-python-setup" class="section level2">
<h2>Appendix 1: Python Setup</h2>
<ul>
<li>Installed postgresql</li>
<li>Installed python venv</li>
<li>Installed wheel - <code>pip install wheel</code></li>
<li>Error installing gnureadline - <code>sudo apt-get install libncurses5-dev</code>
<ul>
<li><code>sudo apt-get install libncurses5-dev libffi-dev</code></li>
</ul></li>
<li>ERROR: Failed building wheel for psycopg2</li>
<li>d <a href="https://medium.com/@stephanedmonson/solution-for-connecting-postgresql-via-wsl-windows-subsystem-for-linux-ubuntu18-c79940fa5742">psql problems</a></li>
</ul>
</div>
</div>
