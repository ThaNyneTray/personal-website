---
title: "An Analysis of Eminem Lyrics - NLP"
author: "Desmond Tuiyot"
date: '2020-05-23'
slug: eminem-lyrics-analysis-nlp
tags:
- R
- NLP
- tf_idf
- data analysis
- exploratory data analysis
- ggplot2
- dplyr
- tidy text mining
categories:
- R
- NLP
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="this-is-a-test-post-for-my-incoming-blog-and-a-sneak-peek-to-my-first-post.-given-that-its-a-test-post-though-i-reserve-the-right-to-write-terribly." class="section level2">
<h2>This is a test post for my incoming blog, and a sneak peek to my first post. Given that it’s a test post, though, I reserve the right to write terribly.</h2>
<p>Eminem has been a phenomenon since The Slim Shady LP caught Dr. Dre’s ears. Throughout his career, Eminem has filled the airwaves with his thoughts and emotions. Here we perform an analysis on his lyrics in 2 parts.</p>
<ol style="list-style-type: decimal">
<li><strong>Text Mining and Exploratory Analysis</strong><br />
</li>
<li><strong>Sentiment Analysis and Topic Modeling</strong></li>
</ol>
</div>
<div id="some-r-code" class="section level2">
<h2>Some r code</h2>
<p>First, let’s load the libraries we’ll need.</p>
<pre class="r"><code>library(dplyr)
library(tidyr)
library(tidytext)
library(ggplot2)
library(geniusr)
library(stringr)
library(Rspotify)
library(readr)
library(forcats)
library(purrr)
library(broom)
library(wordcloud2)
library(lubridate)</code></pre>
<p>The first step is to get the lyrics. Here I used the Spotify API to get a list of Eminem’s albums and then utilized the Genius API to get the lyrics. Finally, I saved the original lyrics data set to a csv file for future access. The code is as below</p>
<pre class="r"><code>#### specify authorization key ###################################################
keys&lt;-spotifyOAuth(app_id=&quot;EvolutionOfHipHop&quot;,
                   client_id=&quot;fb596ca0990a475fa1203b3dec8370a9&quot;,
                   client_secret=&quot;a94a49dc86cf42e087dd68a30178fd5c&quot;)

# we get the album list from  Spotify - genius API lacks this feature
id&lt;-searchArtist(&quot;Eminem&quot;, keys)$id[1]
albums&lt;-getAlbums(artist_id=id, token=keys)
albums&lt;-unique(albums$name)
albums&lt;-albums[c(1,2,3,5,6,8,11,12,14,16)]

track_list&lt;-NULL
for (i in 1:length(albums)){
  tracks&lt;-get_album_tracklist_search(&quot;Eminem&quot;, albums[i])
  tracks$album&lt;-albums[i]
  track_list&lt;-rbind(track_list, tracks)
}
track_list

#
# # save the track_list data to a csv
write.csv(track_list, file=&quot;../../static/data/track_list_data.csv&quot;, row.names=F)

## load the track_list data frame if needed later
track_list&lt;-read.csv(&quot;../../static/data/track_list_data.csv&quot;, stringsAsFactors=F)


# get lyrics for the entire tracklist, and combine them into a data frame
lyrics&lt;-c()
for (i in 1:nrow(track_list)){
  album_lyric&lt;-get_lyrics_url(track_list$song_lyrics_url[i]) %&gt;%
    mutate(album=track_list$album[i],
           track_number=track_list$song_number[i])
  lyrics&lt;-rbind(lyrics, album_lyric)
}

# add album years as well
album_year&lt;-c(&quot;01-17-2020&quot;,&quot;08-31-2018&quot;,&quot;12-15-2017&quot;,&quot;11-5-2013&quot;,&quot;06-18-2010&quot;,
              &quot;05-15-2009&quot;,&quot;11-12-2004&quot;,&quot;05-26-2002&quot;,&quot;05-23-2000&quot;,&quot;02-23-1999&quot;)
album_year&lt;-mdy(album_year)

album_dates&lt;-tibble(album=albums,album_year=album_year)
#
# # add dates to the lyrics. THese are album dates. Useful later on
lyrics&lt;-lyrics %&gt;%
  inner_join(album_dates, by=c(&quot;album&quot;))
#
lyrics
#
# # save the original lyric data
write_csv(lyrics, &quot;../../static/data/original_lyrics.csv&quot;)

original_lyrics &lt;- read_csv(&quot;../../static/data/original_lyrics.csv&quot;)</code></pre>
<p>Next, I performed some preliminary cleaning of the data. First, I wanted to look at Eminem’s lyrics only; the lyrics data set returned by Genius API has a section artist section, which makes it easy. The exception is the song <strong>Arose</strong> from his album <strong>Revival</strong>. Here, the verses are labeled in parts, so the section artists also are labeled this way.</p>
<pre class="r"><code>original_lyrics &lt;- read_csv(&quot;../../static/data/original_lyrics.csv&quot;)

lyrics&lt;-original_lyrics %&gt;%
  filter(str_detect(section_artist, &quot;Eminem&quot;)|
         section_artist==&quot;Arose&quot;|
         section_artist==&quot;Castle Extended&quot;) %&gt;%
  rename(lyric=line, track_n=track_number) %&gt;%
  group_by(song_name) %&gt;%
  mutate(line=cumsum(song_name==song_name)) %&gt;%
  select(lyric, line, album, track_n, song_name, album_year)

# # save data to csv file for future access
write_csv(lyrics, path=&quot;../../static/data/lyrics_by_lines.csv&quot;)
# 
# # load lyrics data
lyrics&lt;-read_csv(file=&quot;../../static/data/lyrics_by_lines.csv&quot;)

lyrics</code></pre>
<pre><code>## # A tibble: 14,862 x 6
##    lyric                    line album          track_n song_name     album_year
##    &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;    
##  1 Yeah                        1 Music To Be M~       1 Premonition ~ 2020-01-17
##  2 So I guess this is wha~     2 Music To Be M~       1 Premonition ~ 2020-01-17
##  3 Think it&#39;s obvious          3 Music To Be M~       1 Premonition ~ 2020-01-17
##  4 We ain&#39;t never gonna s~     4 Music To Be M~       1 Premonition ~ 2020-01-17
##  5 But it&#39;s funny              5 Music To Be M~       1 Premonition ~ 2020-01-17
##  6 As much as I hate you       6 Music To Be M~       1 Premonition ~ 2020-01-17
##  7 I need you                  7 Music To Be M~       1 Premonition ~ 2020-01-17
##  8 This is music to be mu~     8 Music To Be M~       1 Premonition ~ 2020-01-17
##  9 They said my last albu~     9 Music To Be M~       1 Premonition ~ 2020-01-17
## 10 No, I sound like a spi~    10 Music To Be M~       1 Premonition ~ 2020-01-17
## # ... with 14,852 more rows</code></pre>
<p>Finally, I explored contractions in this data set and came up with a list of contractions and their corrections. I defined a function to expand these contractions. After this, I removed any non alphanumeric characters from the data set.</p>
<pre class="r"><code>fix_contractions&lt;-function(dat){
  # as in the article, this could be a possesive or is/has
  dat&lt;-str_replace_all(dat, &quot;&#39;s&quot;, &quot;&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;m&quot;, &quot; am&quot;)
  # this one could be had or would, but I decide to replace with would
  # barring analysis of tense, which I don&#39;t intend to do, this probably has no effect
  dat&lt;-str_replace_all(dat, &quot;&#39;d&quot;, &quot; would&quot;)
  # special cases of the n&#39;t contraction - won&#39;t and can&#39;t
  dat&lt;-str_replace_all(dat, &quot;can&#39;t&quot;, &quot;cannot&quot;)
  dat&lt;-str_replace_all(dat, &quot;won&#39;t&quot;, &quot;will not&quot;)
  dat&lt;-str_replace_all(dat, &quot;don&#39;tchu&quot;, &quot;don&#39;t you&quot;)
  # ain&#39;t is a special case.
  dat&lt;-str_replace_all(dat, &quot;ain&#39;t&quot;, &quot;aint&quot;)
  dat&lt;-str_replace_all(dat, &quot;n&#39;t&quot;, &quot; not&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;re&quot;, &quot; are&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;ve&quot;, &quot; have&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;ll&quot;, &quot; will&quot;)
  dat&lt;-str_replace_all(dat, &quot;y&#39;all&quot;, &quot;you all&quot;)
  dat&lt;-str_replace_all(dat, &quot;e&#39;ry&quot;, &quot;every&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;da&quot;, &quot; would have&quot;)
  dat&lt;-str_replace_all(dat, &quot;a&#39;ight&quot;, &quot;all right&quot;)
  dat&lt;-str_replace_all(dat, &quot;prob&#39;ly&quot;, &quot;probably&quot;)
  dat&lt;-str_replace_all(dat, &quot;&#39;em&quot;, &quot;them&quot;)
  # gerund contractions
  dat&lt;-str_replace_all(dat, &quot;in&#39;\\s&quot;, &quot;ing  &quot;)
  # finna, wanna, gonna
  dat&lt;-str_replace_all(dat, &quot;gonna&quot;, &quot;going to&quot;)
  dat&lt;-str_replace_all(dat, &quot;finna&quot;, &quot;going to&quot;)
  dat&lt;-str_replace_all(dat, &quot;wanna&quot;, &quot;want to&quot;)
  dat
}
# # 
lyrics$lyric&lt;-tolower(lyrics$lyric)
lyrics$lyric&lt;-fix_contractions(lyrics$lyric)
lyrics %&gt;%
  filter(str_detect(lyric, &quot;ing&quot;))</code></pre>
<pre><code>## # A tibble: 3,625 x 6
##    lyric                        line album       track_n song_name    album_year
##    &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;        &lt;date&gt;    
##  1 we aint never going to see~     4 Music To B~       1 Premonition~ 2020-01-17
##  2 then i woulda quit a long ~    18 Music To B~       1 Premonition~ 2020-01-17
##  3 looking at them plaques, c~    23 Music To B~       1 Premonition~ 2020-01-17
##  4 but rolling stone stars, i~    27 Music To B~       1 Premonition~ 2020-01-17
##  5 they said i am lyrically a~    40 Music To B~       1 Premonition~ 2020-01-17
##  6 but i have nothing to say      41 Music To B~       1 Premonition~ 2020-01-17
##  7 but then when i put out re~    42 Music To B~       1 Premonition~ 2020-01-17
##  8 fans keep on pulling me on~    48 Music To B~       1 Premonition~ 2020-01-17
##  9 i was not dissing  tech, t~    58 Music To B~       1 Premonition~ 2020-01-17
## 10 instead of us being credit~    60 Music To B~       1 Premonition~ 2020-01-17
## # ... with 3,615 more rows</code></pre>
<pre class="r"><code># here then let&#39;s clean out  the rest of the lyrics. Remove
# non-alphanumeric characters
lyrics$lyric &lt;- str_replace_all(lyrics$lyric, &quot;[^a-zA-Z0-9 ]&quot;, &quot; &quot;)
sum(str_detect(lyrics$lyric, &quot;[^a-zA-Z0-9 ]&quot;)) # we goodie</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code># save cleaned data to csv file for future access
write_csv(lyrics, &quot;../../static/data/lyrics_by_lines.csv&quot;)

 
# load lyrics data
lyrics&lt;-read_csv(file=&quot;../../static/data/lyrics_by_lines.csv&quot;)

lyrics</code></pre>
<pre><code>## # A tibble: 14,862 x 6
##    lyric                    line album          track_n song_name     album_year
##    &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;         &lt;date&gt;    
##  1 yeah                        1 Music To Be M~       1 Premonition ~ 2020-01-17
##  2 so i guess this is wha~     2 Music To Be M~       1 Premonition ~ 2020-01-17
##  3 think it obvious            3 Music To Be M~       1 Premonition ~ 2020-01-17
##  4 we aint never going to~     4 Music To Be M~       1 Premonition ~ 2020-01-17
##  5 but it funny                5 Music To Be M~       1 Premonition ~ 2020-01-17
##  6 as much as i hate you       6 Music To Be M~       1 Premonition ~ 2020-01-17
##  7 i need you                  7 Music To Be M~       1 Premonition ~ 2020-01-17
##  8 this is music to be mu~     8 Music To Be M~       1 Premonition ~ 2020-01-17
##  9 they said my last albu~     9 Music To Be M~       1 Premonition ~ 2020-01-17
## 10 no  i sound like a spi~    10 Music To Be M~       1 Premonition ~ 2020-01-17
## # ... with 14,852 more rows</code></pre>
</div>
